<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>XPU-DSAM7S: USBRCVR Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>USBRCVR Class Reference</h1><!-- doxytag: class="USBRCVR" --><code>#include &lt;<a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>&gt;</code>
<p>

<p>
<a href="class_u_s_b_r_c_v_r-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#482d96fcc94967bc8f507094676dce12">USBRCVR</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#5b07e0cb5d3512ecd929fb3592db2658">Initialize</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#aa847e4e71760b636d2890a3521febc3">ReadMoreData</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#f8361a896588ddbb643a4b79b59129b5">Receiver</a> (void)</td></tr>

<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#0470b854d786704120a34caebb74b242">portTASK_FUNCTION</a> (MainTask, pvParameters)</td></tr>

<tr><td colspan="2"><br><h2>Static Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#343cfd733e1e9da5317e6432cd3ea720">OnReceiveUSB</a> (<a class="el" href="class_u_s_b_r_c_v_r.html">USBRCVR</a> *pThis, <a class="el" href="common_8h.html#65f85814a8290f9797005d3b28e7e5fc">uchar</a> <a class="el" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a>, <a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="el" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a>, <a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="el" href="class_u_s_b_r_c_v_r.html#e11c88a0de1828a7b0e7a11b1f380750">dBytesRemaining</a>)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#5c3658f422a2d05b586fbde8e60c3f2e">bufSize</a></td></tr>

<tr><td class="memItemLeft" nowrap>union {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="common_8h.html#65f85814a8290f9797005d3b28e7e5fc">uchar</a>&nbsp;&nbsp;&nbsp;<a class="el" href="class_u_s_b_r_c_v_r.html#f1adb81cf89bf94db9264eed04a6d8a6">buf</a> [USB_RCVR_BUF_SIZE]</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;struct <b>XPI_OMSG_HEADER</b> {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="el" href="common_8h.html#65f85814a8290f9797005d3b28e7e5fc">uchar</a>&nbsp;&nbsp;&nbsp;<a class="el" href="class_u_s_b_r_c_v_r.html#314787643fcecf9da63b6f4ffa2208f5">data</a> [0]</td></tr>

<tr><td class="memItemLeft" nowrap valign="top">&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;<a class="el" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a></td></tr>

<tr><td class="memItemLeft" nowrap valign="top">};&nbsp;</td><td class="memItemRight" valign="bottom"></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile <a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile <a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#e11c88a0de1828a7b0e7a11b1f380750">dBytesRemaining</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classx_s_e_m_a.html">xSEMA</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_r_c_v_r.html#a4d0a9f5f141767eceec755624addf04">semaReceived</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00162">162</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="482d96fcc94967bc8f507094676dce12"></a><!-- doxytag: member="USBRCVR::USBRCVR" ref="482d96fcc94967bc8f507094676dce12" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">USBRCVR::USBRCVR           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00214">214</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>References <a class="el" href="sam7xpud_8hpp-source.html#l00168">bufSize</a>, and <a class="el" href="sam7xpud_8hpp-source.html#l00067">USB_RCVR_BUF_SIZE</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00215"></a>00215         : <a class="code" href="class_u_s_b_r_c_v_r.html#a4d0a9f5f141767eceec755624addf04">semaReceived</a>( 0 )
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217         <a class="code" href="class_u_s_b_r_c_v_r.html#5c3658f422a2d05b586fbde8e60c3f2e">bufSize</a> = <a class="code" href="sam7xpud_8hpp.html#dc29c2ff13d900c2f185ee95427fb06caba55b767751b29a84e8acb3797a5cf5">USB_RCVR_BUF_SIZE</a>;
<a name="l00218"></a>00218         }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="343cfd733e1e9da5317e6432cd3ea720"></a><!-- doxytag: member="USBRCVR::OnReceiveUSB" ref="343cfd733e1e9da5317e6432cd3ea720" args="(USBRCVR *pThis, uchar bStatus, uint dBytesTransferred, uint dBytesRemaining)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void USBRCVR::OnReceiveUSB           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_u_s_b_r_c_v_r.html">USBRCVR</a> *&nbsp;</td>
          <td class="paramname"> <em>pThis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="common_8h.html#65f85814a8290f9797005d3b28e7e5fc">uchar</a>&nbsp;</td>
          <td class="paramname"> <em>bStatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&nbsp;</td>
          <td class="paramname"> <em>dBytesTransferred</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&nbsp;</td>
          <td class="paramname"> <em>dBytesRemaining</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [inline, static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00192">192</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>References <a class="el" href="sam7xpud_8hpp-source.html#l00180">bStatus</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00182">dBytesRemaining</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00181">dBytesTransferred</a>, <a class="el" href="usb_tasks_8cpp-source.html#l00016">isTaskWokenByPostInUsbIrq</a>, <a class="el" href="sema_8cpp-source.html#l00098">xSEMA::ReleaseFromISR()</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00186">semaReceived</a>, and <a class="el" href="usb_framework_8hpp-source.html#l00337">USB::USB_STATUS_IMMEDREAD</a>.</p>

<p>Referenced by <a class="el" href="sam7xpud_8hpp-source.html#l00220">Initialize()</a>, and <a class="el" href="sam7xpud_8hpp-source.html#l00253">ReadMoreData()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00198"></a>00198     {
<a name="l00199"></a>00199         pThis-&gt;<a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a> = <a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a>;
<a name="l00200"></a>00200         pThis-&gt;<a class="code" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a> = <a class="code" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a>;
<a name="l00201"></a>00201         pThis-&gt;<a class="code" href="class_u_s_b_r_c_v_r.html#e11c88a0de1828a7b0e7a11b1f380750">dBytesRemaining</a> = <a class="code" href="class_u_s_b_r_c_v_r.html#e11c88a0de1828a7b0e7a11b1f380750">dBytesRemaining</a>;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         <span class="keywordflow">if</span> ( <a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a> == <a class="code" href="namespace_u_s_b.html#70e8bfc29952edb58ad9672bcb778bdf559ef442426e3d388d43f11e453ac54e">USB::USB_STATUS_IMMEDREAD</a> )
<a name="l00204"></a>00204             <span class="keywordflow">return</span>; <span class="comment">// Must not call ReleaseFromISR() out of ISR</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="keywordflow">if</span> ( pThis-&gt;<a class="code" href="class_u_s_b_r_c_v_r.html#a4d0a9f5f141767eceec755624addf04">semaReceived</a>.<a class="code" href="classx_s_e_m_a.html#138c0f59a8444912bb8d1c083bad64ed">ReleaseFromISR</a>( 1, <a class="code" href="sam7xpud_8hpp.html#8016362bfba98bf35c540ad23a34843e">isTaskWokenByPostInUsbIrq</a> ) )
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208             <a class="code" href="sam7xpud_8hpp.html#8016362bfba98bf35c540ad23a34843e">isTaskWokenByPostInUsbIrq</a> = pdTRUE;
<a name="l00209"></a>00209             }
<a name="l00210"></a>00210         }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5b07e0cb5d3512ecd929fb3592db2658"></a><!-- doxytag: member="USBRCVR::Initialize" ref="5b07e0cb5d3512ecd929fb3592db2658" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBRCVR::Initialize           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00220">220</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>References <a class="el" href="sam7xpud_8hpp-source.html#l00171">buf</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00168">bufSize</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00192">OnReceiveUSB()</a>, <a class="el" href="usb_c_d_c_8hpp-source.html#l00403">USB::CCDC::Read()</a>, <a class="el" href="trace_8h-source.html#l00061">TRACE_INFO</a>, <a class="el" href="usb_framework_8hpp-source.html#l00334">USB::USB_STATUS_ABORTED</a>, and <a class="el" href="usb_framework_8hpp-source.html#l00331">USB::USB_STATUS_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="usb_tasks_8cpp-source.html#l00206">portTASK_FUNCTION()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00221"></a>00221     {
<a name="l00222"></a>00222 <span class="preprocessor">#ifdef TR_INFO        </span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>        taskENTER_CRITICAL ();
<a name="l00224"></a>00224         <a class="code" href="trace_8h.html#7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>( <span class="stringliteral">"USBRCVR: Initialize(): Size=%u\n"</span>, <a class="code" href="class_u_s_b_r_c_v_r.html#5c3658f422a2d05b586fbde8e60c3f2e">bufSize</a> );
<a name="l00225"></a>00225         taskEXIT_CRITICAL ();
<a name="l00226"></a>00226 <span class="preprocessor">#endif</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span>
<a name="l00228"></a>00228         <span class="comment">// Wait a bit for USB endpoint to be ready</span>
<a name="l00229"></a>00229         vTaskDelay( 100 );
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a> = <a class="code" href="namespace_u_s_b.html#70e8bfc29952edb58ad9672bcb778bdf7201cca4c6fe2ac04a449c4a3c9310dc" title="Method was aborted because of abnormal status.">USB::USB_STATUS_ABORTED</a>;
<a name="l00232"></a>00232         
<a name="l00233"></a>00233         <span class="keywordflow">for</span>( ;; ) 
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235             taskENTER_CRITICAL ();
<a name="l00236"></a>00236             <span class="keywordtype">int</span> rc = <a class="code" href="sam7xpud_8hpp.html#52ff81f95efae6ffb5a185293c19eaf8">sSer</a>.<a class="code" href="class_u_s_b_1_1_c_c_d_c.html#09bd23b7c7f88d05382e708c9f101552" title="Reads data from the Data OUT endpoint.">Read</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#f1adb81cf89bf94db9264eed04a6d8a6">buf</a>, <a class="code" href="class_u_s_b_r_c_v_r.html#5c3658f422a2d05b586fbde8e60c3f2e">bufSize</a>, <a class="code" href="common_8h.html#a2b4c1da14449a039464b0a1703fb21b">Callback_f</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#343cfd733e1e9da5317e6432cd3ea720">OnReceiveUSB</a> ), <span class="keyword">this</span> );
<a name="l00237"></a>00237             taskEXIT_CRITICAL ();
<a name="l00238"></a>00238             
<a name="l00239"></a>00239             <span class="keywordflow">if</span> ( rc == <a class="code" href="namespace_u_s_b.html#70e8bfc29952edb58ad9672bcb778bdfaaaf695d69c89cb078bf5046502004a0" title="Last method has completed successfully.">USB::USB_STATUS_SUCCESS</a> )
<a name="l00240"></a>00240                 <span class="keywordflow">break</span>;
<a name="l00241"></a>00241             
<a name="l00242"></a>00242             <span class="comment">// USB endopoint is not ready; wait and retry</span>
<a name="l00243"></a>00243             vTaskDelay( 10 );
<a name="l00244"></a>00244             }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="preprocessor">#ifdef TR_INFO</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>        taskENTER_CRITICAL ();
<a name="l00248"></a>00248         <a class="code" href="trace_8h.html#7339bfd784193a5c79efcef2eeb2d6df">TRACE_INFO</a>( <span class="stringliteral">"USBRCVR: Posted initial CCDC::Read\n"</span> );
<a name="l00249"></a>00249         taskEXIT_CRITICAL ();
<a name="l00250"></a>00250 <span class="preprocessor">#endif</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>        }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="aa847e4e71760b636d2890a3521febc3"></a><!-- doxytag: member="USBRCVR::ReadMoreData" ref="aa847e4e71760b636d2890a3521febc3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBRCVR::ReadMoreData           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00253">253</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>References <a class="el" href="sam7xpud_8hpp-source.html#l00171">buf</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00168">bufSize</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00192">OnReceiveUSB()</a>, <a class="el" href="usb_c_d_c_8hpp-source.html#l00403">USB::CCDC::Read()</a>, <a class="el" href="trace_8h-source.html#l00073">TRACE_ERROR</a>, <a class="el" href="usb_framework_8hpp-source.html#l00334">USB::USB_STATUS_ABORTED</a>, and <a class="el" href="usb_framework_8hpp-source.html#l00331">USB::USB_STATUS_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="usb_tasks_8cpp-source.html#l00206">portTASK_FUNCTION()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00254"></a>00254     {
<a name="l00255"></a>00255         <a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a> = <a class="code" href="namespace_u_s_b.html#70e8bfc29952edb58ad9672bcb778bdf7201cca4c6fe2ac04a449c4a3c9310dc" title="Method was aborted because of abnormal status.">USB::USB_STATUS_ABORTED</a>;
<a name="l00256"></a>00256         
<a name="l00257"></a>00257         <span class="keywordflow">for</span>( ;; ) 
<a name="l00258"></a>00258         {
<a name="l00259"></a>00259             taskENTER_CRITICAL ();
<a name="l00260"></a>00260             <span class="keywordtype">int</span> rc = <a class="code" href="sam7xpud_8hpp.html#52ff81f95efae6ffb5a185293c19eaf8">sSer</a>.<a class="code" href="class_u_s_b_1_1_c_c_d_c.html#09bd23b7c7f88d05382e708c9f101552" title="Reads data from the Data OUT endpoint.">Read</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#f1adb81cf89bf94db9264eed04a6d8a6">buf</a>, <a class="code" href="class_u_s_b_r_c_v_r.html#5c3658f422a2d05b586fbde8e60c3f2e">bufSize</a>, <a class="code" href="common_8h.html#a2b4c1da14449a039464b0a1703fb21b">Callback_f</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#343cfd733e1e9da5317e6432cd3ea720">OnReceiveUSB</a> ), <span class="keyword">this</span> );
<a name="l00261"></a>00261             taskEXIT_CRITICAL ();
<a name="l00262"></a>00262             
<a name="l00263"></a>00263             <span class="keywordflow">if</span> ( rc == <a class="code" href="namespace_u_s_b.html#70e8bfc29952edb58ad9672bcb778bdfaaaf695d69c89cb078bf5046502004a0" title="Last method has completed successfully.">USB::USB_STATUS_SUCCESS</a> )
<a name="l00264"></a>00264                 <span class="keywordflow">break</span>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266             <span class="comment">// USB endopoint is not ready; wait and retry</span>
<a name="l00267"></a>00267             <a class="code" href="trace_8h.html#af9a5c67ad0ffd97cfca6d77c6af536f">TRACE_ERROR</a>( <span class="stringliteral">"!R "</span> );
<a name="l00268"></a>00268             vTaskDelay( 1 );
<a name="l00269"></a>00269             }
<a name="l00270"></a>00270         }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f8361a896588ddbb643a4b79b59129b5"></a><!-- doxytag: member="USBRCVR::Receiver" ref="f8361a896588ddbb643a4b79b59129b5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void USBRCVR::Receiver           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="usb_tasks_8cpp-source.html#l00248">248</a> of file <a class="el" href="usb_tasks_8cpp-source.html">usbTasks.cpp</a>.</p>

<p>References <a class="el" href="sam7xpud_8hpp-source.html#l00180">bStatus</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00171">buf</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00182">dBytesRemaining</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00181">dBytesTransferred</a>, <a class="el" href="xpi_8cpp-source.html#l00040">XPI::DumpStatus()</a>, <a class="el" href="xsvf_task_8cpp-source.html#l00125">XSVF_Player::Enable()</a>, <a class="el" href="fpga_8hpp-source.html#l00119">FPGA_BegRead()</a>, <a class="el" href="fpga_8hpp-source.html#l00114">FPGA_BegWrite()</a>, <a class="el" href="fpga_8cpp-source.html#l00051">FPGA_FC_Command()</a>, <a class="el" href="fpga_8hpp-source.html#l00135">FPGA_Read()</a>, <a class="el" href="fpga_8hpp-source.html#l00124">FPGA_Write()</a>, <a class="el" href="xpi_8cpp-source.html#l00121">XPI::InitializeFPGA()</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00373">XSVF_Player::LockBuffer()</a>, <a class="el" href="xpi_8hpp-source.html#l00052">XPI_OMSG_HEADER::magicLSB</a>, <a class="el" href="xpi_8hpp-source.html#l00051">XPI_OMSG_HEADER::magicMSB</a>, <a class="el" href="sam7xpud_8cpp-source.html#l00036">null_putc()</a>, <a class="el" href="xpi_8cpp-source.html#l01028">XPI::Put()</a>, <a class="el" href="usb_tasks_8cpp-source.html#l00058">USBXMTR::Put()</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00186">semaReceived</a>, <a class="el" href="xpi_8hpp-source.html#l00269">XPI::SetTraceMask()</a>, <a class="el" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>, <a class="el" href="xpi_8hpp-source.html#l00054">XPI_OMSG_HEADER::subtype</a>, <a class="el" href="sam7xpud_8cpp-source.html#l00176">sysDumpStatus()</a>, <a class="el" href="trace_8h-source.html#l00049">TRACE_DEBUG_M</a>, <a class="el" href="trace_8h-source.html#l00073">TRACE_ERROR</a>, <a class="el" href="stdio_8cpp-source.html#l00063">tracef_open()</a>, <a class="el" href="xpi_8hpp-source.html#l00053">XPI_OMSG_HEADER::type</a>, <a class="el" href="sam7xpud_8cpp-source.html#l00025">us1_putc()</a>, <a class="el" href="sam7xpud_8cpp-source.html#l00044">usb_putc()</a>, <a class="el" href="usb_framework_8hpp-source.html#l00337">USB::USB_STATUS_IMMEDREAD</a>, <a class="el" href="usb_framework_8hpp-source.html#l00331">USB::USB_STATUS_SUCCESS</a>, <a class="el" href="sema_8cpp-source.html#l00148">xSEMA::Wait()</a>, <a class="el" href="xpi_8cpp-source.html#l00018">xpi</a>, <a class="el" href="xpi_8hpp-source.html#l00020">XPI_IMSG_LOOP</a>, <a class="el" href="xpi_8hpp-source.html#l00036">XPI_MSG_MAGIC_LSB</a>, <a class="el" href="xpi_8hpp-source.html#l00035">XPI_MSG_MAGIC_MSB</a>, <a class="el" href="xpi_8hpp-source.html#l00013">XPI_OMSG_FC_CMD</a>, <a class="el" href="xpi_8hpp-source.html#l00012">XPI_OMSG_FPGA_INIT</a>, <a class="el" href="xpi_8hpp-source.html#l00009">XPI_OMSG_LOG_CFG</a>, <a class="el" href="xpi_8hpp-source.html#l00007">XPI_OMSG_LOOP</a>, <a class="el" href="xpi_8hpp-source.html#l00006">XPI_OMSG_NULL</a>, <a class="el" href="xpi_8hpp-source.html#l00008">XPI_OMSG_QUERY</a>, <a class="el" href="xpi_8hpp-source.html#l00014">XPI_OMSG_SC_DATA</a>, <a class="el" href="xpi_8hpp-source.html#l00011">XPI_OMSG_XSVF_DATA</a>, <a class="el" href="xpi_8hpp-source.html#l00010">XPI_OMSG_XSVF_START</a>, <a class="el" href="fpga_8hpp-source.html#l00059">XPI_R_P1_BOARD_POS</a>, <a class="el" href="fpga_8hpp-source.html#l00072">XPI_W_PAGE_ADDR</a>, and <a class="el" href="xsvf_task_8cpp-source.html#l00013">xsvf</a>.</p>

<p>Referenced by <a class="el" href="usb_tasks_8cpp-source.html#l00206">portTASK_FUNCTION()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00249"></a>00249 {
<a name="l00250"></a>00250     <span class="comment">// Check whether read callback has returned already found in FIFO. If not</span>
<a name="l00251"></a>00251     <span class="comment">// then we should wait for read callback to complete.</span>
<a name="l00252"></a>00252     <span class="comment">//</span>
<a name="l00253"></a>00253     <span class="keywordflow">if</span> ( <a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a> != <a class="code" href="namespace_u_s_b.html#70e8bfc29952edb58ad9672bcb778bdf559ef442426e3d388d43f11e453ac54e">USB::USB_STATUS_IMMEDREAD</a> )
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255         <span class="comment">// Wait callback to receive data</span>
<a name="l00256"></a>00256         <span class="comment">//</span>
<a name="l00257"></a>00257         do ; <span class="keywordflow">while</span>( ! <a class="code" href="class_u_s_b_r_c_v_r.html#a4d0a9f5f141767eceec755624addf04">semaReceived</a>.<a class="code" href="classx_s_e_m_a.html#d398bc33f1c28f28c33ce1796b0e4ca7">Wait</a>( 1, 1000 ) );
<a name="l00258"></a>00258         
<a name="l00259"></a>00259         <span class="comment">// Check CCDC::Read() callback status</span>
<a name="l00260"></a>00260         <span class="comment">//</span>
<a name="l00261"></a>00261         <span class="keywordflow">if</span> ( <a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a> != <a class="code" href="namespace_u_s_b.html#70e8bfc29952edb58ad9672bcb778bdfaaaf695d69c89cb078bf5046502004a0" title="Last method has completed successfully.">USB::USB_STATUS_SUCCESS</a> ) 
<a name="l00262"></a>00262         {
<a name="l00263"></a>00263 <span class="preprocessor">#ifdef TR_ERROR            </span>
<a name="l00264"></a>00264 <span class="preprocessor"></span>            taskENTER_CRITICAL ();
<a name="l00265"></a>00265             <a class="code" href="trace_8h.html#af9a5c67ad0ffd97cfca6d77c6af536f">TRACE_ERROR</a>( <span class="stringliteral">"USBRCVR: Transfer error\n"</span> );
<a name="l00266"></a>00266             taskEXIT_CRITICAL ();
<a name="l00267"></a>00267 <span class="preprocessor">#endif</span>
<a name="l00268"></a>00268 <span class="preprocessor"></span>            <span class="keywordflow">return</span>;
<a name="l00269"></a>00269             }
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="preprocessor">#ifdef TR_DEBUG_M</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>    taskENTER_CRITICAL ();
<a name="l00274"></a>00274     <a class="code" href="trace_8h.html#e5a536c839faf35fa9396e29abf2a0ab">TRACE_DEBUG_M</a>( <span class="stringliteral">"USBRCVR: Got %6u, %5u; RC = %d\n"</span>, 
<a name="l00275"></a>00275             <a class="code" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a>, <a class="code" href="class_u_s_b_r_c_v_r.html#e11c88a0de1828a7b0e7a11b1f380750">dBytesRemaining</a>, <a class="code" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">bStatus</a> );
<a name="l00276"></a>00276     taskEXIT_CRITICAL ();
<a name="l00277"></a>00277 <span class="preprocessor">#endif</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>
<a name="l00279"></a>00279     <span class="keywordflow">if</span> ( <a class="code" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a> == 0 )
<a name="l00280"></a>00280         <span class="keywordflow">return</span>;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="keywordtype">int</span> dataLen = <a class="code" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a> - <span class="keyword">sizeof</span>( <a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html">XPI_OMSG_HEADER</a> );
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="comment">// Loopback XPI_OMSG messages without proper header</span>
<a name="l00285"></a>00285     <span class="comment">//</span>
<a name="l00286"></a>00286     <span class="keywordflow">if</span> ( dataLen &lt; 0 
<a name="l00287"></a>00287         || <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#67ee35372f8011fcbe8d58970415f4b8">magicMSB</a> != <a class="code" href="xpi_8hpp.html#39fca1837c5ce7715cbf571669660c13259bbcd3cf013df704a6da0b4961e0af">XPI_MSG_MAGIC_MSB</a> 
<a name="l00288"></a>00288         || <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#aa7e1a684105e972150fd64ec387e225">magicLSB</a> != <a class="code" href="xpi_8hpp.html#39fca1837c5ce7715cbf571669660c1361a80b9fbb0958f26a47294a567918a7">XPI_MSG_MAGIC_LSB</a> 
<a name="l00289"></a>00289         )
<a name="l00290"></a>00290     {
<a name="l00291"></a>00291         <span class="keywordflow">if</span> ( <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#67ee35372f8011fcbe8d58970415f4b8">magicMSB</a> == <span class="charliteral">'?'</span> )
<a name="l00292"></a>00292             <a class="code" href="xpi_8cpp.html#b400f7e2baa54c09ba8db2c8d929b238">xpi</a>.<a class="code" href="class_x_p_i.html#74381af57a983610abb488730eab82bb">DumpStatus</a> ();
<a name="l00293"></a>00293         <span class="keywordflow">else</span>
<a name="l00294"></a>00294             <a class="code" href="sam7xpud_8hpp.html#9700c6a3205c12058c9b82f9caca843f">usbOut</a>.<a class="code" href="class_u_s_b_x_m_t_r.html#149d280fef7548a52d67fcb5c5ac3ea6">Put</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#f1adb81cf89bf94db9264eed04a6d8a6">buf</a>, <a class="code" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a>, 1000 );
<a name="l00295"></a>00295         <span class="keywordflow">return</span>;
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="comment">// Process XPI_OMSG depending on message type</span>
<a name="l00299"></a>00299     <span class="comment">//</span>
<a name="l00300"></a>00300     <span class="keywordflow">switch</span>( <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#71c1105219dd83fbbeddb7f40b68065d">type</a> )
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00303"></a>00303         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde9197e0b0715dc45044e43b1f2baa1c7febd">XPI_OMSG_NULL</a>:
<a name="l00304"></a>00304             <span class="keywordflow">break</span>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00307"></a>00307         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde91924e36d5fb3fc2fb3a2e7b4a321b62406">XPI_OMSG_LOOP</a>:
<a name="l00308"></a>00308         {
<a name="l00309"></a>00309             <span class="keywordflow">if</span> ( <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#2df970896aec02bd91f8d8864c10d1f2">subtype</a> != 0 )
<a name="l00310"></a>00310             {
<a name="l00311"></a>00311                 <span class="comment">// Simulate FPGA I/O</span>
<a name="l00312"></a>00312                 <span class="comment">//</span>
<a name="l00313"></a>00313                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt;= dataLen / 32; i++ )
<a name="l00314"></a>00314                 {
<a name="l00315"></a>00315                     taskENTER_CRITICAL ();
<a name="l00316"></a>00316                     <a class="code" href="fpga_8hpp.html#1b6789ce8965ccb307d548636d964939">FPGA_BegWrite</a> ();
<a name="l00317"></a>00317                     <a class="code" href="fpga_8hpp.html#8ecf613d5fe1af87d8cd076e4d33868b">FPGA_Write</a>( <a class="code" href="fpga_8hpp.html#99fb83031ce9923c84392b4e92f956b538cfbf559eb285fe5976d5c3422430d1">XPI_W_PAGE_ADDR</a>, 1 ); <span class="comment">// Page 1</span>
<a name="l00318"></a>00318                     <a class="code" href="fpga_8hpp.html#a8775c4c73cdae748f93af04e87e6792">FPGA_BegRead</a> ();
<a name="l00319"></a>00319                     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; 64; j++ )
<a name="l00320"></a>00320                         (<span class="keywordtype">void</span>) <a class="code" href="fpga_8hpp.html#fed2dfd736eb1be0b2a3f10e7a284ba6">FPGA_Read</a>( <a class="code" href="fpga_8hpp.html#df764cbdea00d65edcd07bb9953ad2b78362c59078885f35c3c833c47bd6398a">XPI_R_P1_BOARD_POS</a> );
<a name="l00321"></a>00321                     taskEXIT_CRITICAL ();  
<a name="l00322"></a>00322                     }
<a name="l00323"></a>00323                 }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325             <span class="comment">// Loopback packet to usbOut.</span>
<a name="l00326"></a>00326             <span class="comment">//</span>
<a name="l00327"></a>00327             <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#71c1105219dd83fbbeddb7f40b68065d">type</a>    = <a class="code" href="xpi_8hpp.html#2b3150ff0bdfd39d0e6e48e8fb550165787f5a4bc797228cb3383e95061e1860">XPI_IMSG_LOOP</a>;
<a name="l00328"></a>00328             <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#2df970896aec02bd91f8d8864c10d1f2">subtype</a> = 0;
<a name="l00329"></a>00329             <a class="code" href="sam7xpud_8hpp.html#9700c6a3205c12058c9b82f9caca843f">usbOut</a>.<a class="code" href="class_u_s_b_x_m_t_r.html#149d280fef7548a52d67fcb5c5ac3ea6">Put</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#f1adb81cf89bf94db9264eed04a6d8a6">buf</a>, <a class="code" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">dBytesTransferred</a>, 1000 );
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331             <span class="keywordflow">break</span>;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00334"></a>00334         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde919ad44bbd4215166137ee9166067e464b1">XPI_OMSG_XSVF_START</a>:
<a name="l00335"></a>00335         {
<a name="l00336"></a>00336             <span class="comment">// Get XSVF parameters</span>
<a name="l00337"></a>00337             <span class="comment">//</span>
<a name="l00338"></a>00338             <span class="keywordtype">bool</span> traceLevel = dataLen &gt;= 1 ? <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 0 ] : 0;
<a name="l00339"></a>00339             <span class="keywordtype">bool</span> parseOnly  = dataLen &gt;= 2 ? <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 1 ] : <span class="keyword">false</span>;
<a name="l00340"></a>00340             
<a name="l00341"></a>00341             <span class="comment">// Configure std output for XSVF trace (default is null device)</span>
<a name="l00342"></a>00342             <span class="comment">//</span>
<a name="l00343"></a>00343             <span class="keywordflow">if</span> ( dataLen &gt;= 3 &amp;&amp; <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 2 ] == 2 )
<a name="l00344"></a>00344             {
<a name="l00345"></a>00345                 <a class="code" href="trace_8h.html#74e3f5cfdf662bdddec8a4670c21eb65">tracef_open</a>( 1, <a class="code" href="sam7xpud_8hpp.html#409e918fc805f7946dff7e20e5887005">us1_putc</a>, <span class="comment">/*LF2CRLF=*/</span> <span class="keyword">true</span>, <span class="comment">/*TimeStamp=*/</span> <span class="keyword">true</span> );
<a name="l00346"></a>00346                 }
<a name="l00347"></a>00347             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( dataLen &gt;= 3 &amp;&amp; <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 2 ] == 1 )
<a name="l00348"></a>00348             {
<a name="l00349"></a>00349                 <a class="code" href="trace_8h.html#74e3f5cfdf662bdddec8a4670c21eb65">tracef_open</a>( 1, <a class="code" href="sam7xpud_8hpp.html#04af8901fc5c1015eb79acb36ba38ad6">usb_putc</a>, <span class="comment">/*LF2CRLF=*/</span> <span class="keyword">false</span>, <span class="comment">/*TimeStamp=*/</span> <span class="keyword">false</span> );
<a name="l00350"></a>00350                 }
<a name="l00351"></a>00351             <span class="keywordflow">else</span>
<a name="l00352"></a>00352             {
<a name="l00353"></a>00353                 <a class="code" href="trace_8h.html#74e3f5cfdf662bdddec8a4670c21eb65">tracef_open</a>( 1, <a class="code" href="sam7xpud_8hpp.html#8afa8c69746a9bd9a2b2bd3ddf0dcae6">null_putc</a>, <span class="comment">/*LF2CRLF=*/</span> <span class="keyword">false</span>, <span class="comment">/*TimeStamp=*/</span> <span class="keyword">false</span> );
<a name="l00354"></a>00354                 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356             <span class="comment">// Enable (start) XSVF player</span>
<a name="l00357"></a>00357             <span class="comment">//</span>
<a name="l00358"></a>00358             <a class="code" href="xsvf_task_8cpp.html#2eae1c83f74a85332e67c8ecadb9603c">xsvf</a>.<a class="code" href="class_x_s_v_f___player.html#ab49a062790f0a95e08d6f246b2a71b4">Enable</a>( traceLevel, parseOnly );
<a name="l00359"></a>00359             }
<a name="l00360"></a>00360             <span class="keywordflow">break</span>;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00363"></a>00363         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde91962f664285e0259d4dc2d0a6c2e789f12">XPI_OMSG_XSVF_DATA</a>:
<a name="l00364"></a>00364         {
<a name="l00365"></a>00365             <span class="keywordflow">if</span> ( dataLen &gt; 0 )
<a name="l00366"></a>00366             {
<a name="l00367"></a>00367                 <a class="code" href="xsvf_task_8cpp.html#2eae1c83f74a85332e67c8ecadb9603c">xsvf</a>.<a class="code" href="class_x_s_v_f___player.html#4e412ad72e7bc50f79f431305ce0c62c">LockBuffer</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data, dataLen );
<a name="l00368"></a>00368                 }
<a name="l00369"></a>00369             }
<a name="l00370"></a>00370             <span class="keywordflow">break</span>;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00373"></a>00373         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde91969d6b9609ee9e7df4afa9170f342bb43">XPI_OMSG_FPGA_INIT</a>:
<a name="l00374"></a>00374         {
<a name="l00375"></a>00375             <span class="keywordtype">bool</span> coldStart    = dataLen &gt;= 1 ? <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 0 ] : <span class="keyword">false</span>;
<a name="l00376"></a>00376             <span class="keywordtype">bool</span> forcePassive = dataLen &gt;= 2 ? <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 1 ] : <span class="keyword">false</span>;
<a name="l00377"></a>00377             <a class="code" href="xpi_8cpp.html#b400f7e2baa54c09ba8db2c8d929b238">xpi</a>.<a class="code" href="class_x_p_i.html#13617d172b308c1448c74f4535b2e73d">InitializeFPGA</a>( coldStart, forcePassive );
<a name="l00378"></a>00378             }
<a name="l00379"></a>00379             <span class="keywordflow">break</span>;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00382"></a>00382         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde919044f2bf0dbddf2835442e40d1feddc3e">XPI_OMSG_QUERY</a>:
<a name="l00383"></a>00383         {
<a name="l00384"></a>00384             <span class="keywordflow">if</span> ( <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.<a class="code" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html#2df970896aec02bd91f8d8864c10d1f2">subtype</a> == 0x01 )
<a name="l00385"></a>00385                 <a class="code" href="xpi_8cpp.html#b400f7e2baa54c09ba8db2c8d929b238">xpi</a>.<a class="code" href="class_x_p_i.html#74381af57a983610abb488730eab82bb">DumpStatus</a> ();
<a name="l00386"></a>00386             <span class="keywordflow">else</span>
<a name="l00387"></a>00387                 <a class="code" href="sam7xpud_8hpp.html#3ffbef8314ccf9023edcd7219e79787c">sysDumpStatus</a> ();
<a name="l00388"></a>00388             }
<a name="l00389"></a>00389             <span class="keywordflow">break</span>;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00392"></a>00392         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde91972c39863552070a5e355493d1ee8622d">XPI_OMSG_LOG_CFG</a>:
<a name="l00393"></a>00393         {
<a name="l00394"></a>00394             <a class="code" href="xpi_8cpp.html#b400f7e2baa54c09ba8db2c8d929b238">xpi</a>.<a class="code" href="class_x_p_i.html#3971ff9033f0f6934ac4ee195cf34468">SetTraceMask</a>( dataLen &gt;= 1 ? <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 0 ] : 0 );
<a name="l00395"></a>00395             }
<a name="l00396"></a>00396             <span class="keywordflow">break</span>;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00399"></a>00399         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde919392b557f4b14ebe0c5db69edf6263094">XPI_OMSG_SC_DATA</a>:
<a name="l00400"></a>00400         {
<a name="l00401"></a>00401             <a class="code" href="xpi_8cpp.html#b400f7e2baa54c09ba8db2c8d929b238">xpi</a>.<a class="code" href="class_x_p_i.html#2120b6e3bee2a8eedaf06fad5017eb8a">Put</a>( <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data, dataLen, 100 );
<a name="l00402"></a>00402             }
<a name="l00403"></a>00403             <span class="keywordflow">break</span>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00406"></a>00406         <span class="keywordflow">case</span> <a class="code" href="xpi_8hpp.html#aaeb7d6bb5758c8aec0413b9affde919a81d43ecb3ffb81548e7171c8d08af59">XPI_OMSG_FC_CMD</a>:
<a name="l00407"></a>00407         {
<a name="l00408"></a>00408             <span class="keywordflow">if</span> ( dataLen &gt;= 2 ) <span class="comment">// Addr with D1 and D0</span>
<a name="l00409"></a>00409             {
<a name="l00410"></a>00410                 <span class="keywordtype">int</span> card = <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 0 ] &amp; 0x3F;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412                 <a class="code" href="fpga_8cpp.html#6ec2141bcc427ee6a3c18bdb187846d3">FPGA_FC_Command</a>( ( card &lt;&lt; 2 ) | ( <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 1 ] &amp; 0x03 )  );
<a name="l00413"></a>00413                 vTaskDelay( 2 );
<a name="l00414"></a>00414                 }
<a name="l00415"></a>00415             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( dataLen &gt;= 1 ) <span class="comment">// Only Addr</span>
<a name="l00416"></a>00416             {
<a name="l00417"></a>00417                 <span class="keywordtype">int</span> card = <a class="code" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">sMsg</a>.data[ 0 ] &amp; 0x3F;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419                 <span class="comment">// Turn off and reset the board</span>
<a name="l00420"></a>00420                 <span class="comment">//</span>
<a name="l00421"></a>00421                 <a class="code" href="fpga_8cpp.html#6ec2141bcc427ee6a3c18bdb187846d3">FPGA_FC_Command</a>( ( card &lt;&lt; 2 ) | 0x00 );
<a name="l00422"></a>00422                 vTaskDelay( 2 );
<a name="l00423"></a>00423 
<a name="l00424"></a>00424                 <span class="comment">// Turn on the board</span>
<a name="l00425"></a>00425                 <span class="comment">//</span>
<a name="l00426"></a>00426                 <a class="code" href="fpga_8cpp.html#6ec2141bcc427ee6a3c18bdb187846d3">FPGA_FC_Command</a>( ( card &lt;&lt; 2 ) | 0x01 );
<a name="l00427"></a>00427                 vTaskDelay( 2 );
<a name="l00428"></a>00428 
<a name="l00429"></a>00429                 <span class="comment">// Is the board installed?</span>
<a name="l00430"></a>00430                 <span class="comment">//</span>
<a name="l00431"></a>00431                 <span class="keywordflow">if</span> ( <a class="code" href="fpga_8cpp.html#6ec2141bcc427ee6a3c18bdb187846d3">FPGA_FC_Command</a>( ( card &lt;&lt; 2 ) | 0x03 ) )
<a name="l00432"></a>00432                 {
<a name="l00433"></a>00433                     vTaskDelay( 2 );
<a name="l00434"></a>00434 
<a name="l00435"></a>00435                     <span class="comment">// Is the board turned on and installed?</span>
<a name="l00436"></a>00436                     <span class="comment">//</span>
<a name="l00437"></a>00437                     <a class="code" href="fpga_8cpp.html#6ec2141bcc427ee6a3c18bdb187846d3">FPGA_FC_Command</a>( ( card &lt;&lt; 2 ) | 0x02 );
<a name="l00438"></a>00438                     }
<a name="l00439"></a>00439                 vTaskDelay( 2 );
<a name="l00440"></a>00440                 }
<a name="l00441"></a>00441             }
<a name="l00442"></a>00442             <span class="keywordflow">break</span>;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="comment">//-------------------------------------------------------------------------------</span>
<a name="l00445"></a>00445         <span class="keywordflow">default</span>:
<a name="l00446"></a>00446             <span class="comment">// TODO: issue warning "unknown XPI_OMSG"</span>
<a name="l00447"></a>00447             <span class="keywordflow">break</span>;
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449     }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0470b854d786704120a34caebb74b242"></a><!-- doxytag: member="USBRCVR::portTASK_FUNCTION" ref="0470b854d786704120a34caebb74b242" args="(MainTask, pvParameters)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static USBRCVR::portTASK_FUNCTION           </td>
          <td>(</td>
          <td class="paramtype">MainTask&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pvParameters&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="5c3658f422a2d05b586fbde8e60c3f2e"></a><!-- doxytag: member="USBRCVR::bufSize" ref="5c3658f422a2d05b586fbde8e60c3f2e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="el" href="class_u_s_b_r_c_v_r.html#5c3658f422a2d05b586fbde8e60c3f2e">USBRCVR::bufSize</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00168">168</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>Referenced by <a class="el" href="sam7xpud_8hpp-source.html#l00220">Initialize()</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00253">ReadMoreData()</a>, and <a class="el" href="sam7xpud_8hpp-source.html#l00214">USBRCVR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f1adb81cf89bf94db9264eed04a6d8a6"></a><!-- doxytag: member="USBRCVR::buf" ref="f1adb81cf89bf94db9264eed04a6d8a6" args="[USB_RCVR_BUF_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="common_8h.html#65f85814a8290f9797005d3b28e7e5fc">uchar</a> <a class="el" href="class_u_s_b_r_c_v_r.html#f1adb81cf89bf94db9264eed04a6d8a6">USBRCVR::buf</a>[USB_RCVR_BUF_SIZE]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00171">171</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>Referenced by <a class="el" href="sam7xpud_8hpp-source.html#l00220">Initialize()</a>, <a class="el" href="sam7xpud_8hpp-source.html#l00253">ReadMoreData()</a>, and <a class="el" href="usb_tasks_8cpp-source.html#l00248">Receiver()</a>.</p>

</div>
</div><p>
<a class="anchor" name="314787643fcecf9da63b6f4ffa2208f5"></a><!-- doxytag: member="USBRCVR::data" ref="314787643fcecf9da63b6f4ffa2208f5" args="[0]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="common_8h.html#65f85814a8290f9797005d3b28e7e5fc">uchar</a> <a class="el" href="class_u_s_b_r_c_v_r.html#314787643fcecf9da63b6f4ffa2208f5">USBRCVR::data</a>[0]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00175">175</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

</div>
</div><p>
<a class="anchor" name="2f237caab2ca42b2264e15b3f22e4930"></a><!-- doxytag: member="USBRCVR::sMsg" ref="2f237caab2ca42b2264e15b3f22e4930" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... } ::<a class="el" href="struct_x_p_i___o_m_s_g___h_e_a_d_e_r.html">XPI_OMSG_HEADER</a> <a class="el" href="class_u_s_b_r_c_v_r.html#2f237caab2ca42b2264e15b3f22e4930">USBRCVR::sMsg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="usb_tasks_8cpp-source.html#l00248">Receiver()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0a0b5318f29c572cc0b580b02949534b"></a><!-- doxytag: member="USBRCVR::@6" ref="0a0b5318f29c572cc0b580b02949534b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">union { ... } <code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="be8494d0581b59e769dfbe1a9f095a28"></a><!-- doxytag: member="USBRCVR::bStatus" ref="be8494d0581b59e769dfbe1a9f095a28" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile int <a class="el" href="class_u_s_b_r_c_v_r.html#be8494d0581b59e769dfbe1a9f095a28">USBRCVR::bStatus</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00180">180</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>Referenced by <a class="el" href="sam7xpud_8hpp-source.html#l00192">OnReceiveUSB()</a>, and <a class="el" href="usb_tasks_8cpp-source.html#l00248">Receiver()</a>.</p>

</div>
</div><p>
<a class="anchor" name="36d3af3eed732b8f113e94be2233c69b"></a><!-- doxytag: member="USBRCVR::dBytesTransferred" ref="36d3af3eed732b8f113e94be2233c69b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="el" href="class_u_s_b_r_c_v_r.html#36d3af3eed732b8f113e94be2233c69b">USBRCVR::dBytesTransferred</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00181">181</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>Referenced by <a class="el" href="sam7xpud_8hpp-source.html#l00192">OnReceiveUSB()</a>, and <a class="el" href="usb_tasks_8cpp-source.html#l00248">Receiver()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e11c88a0de1828a7b0e7a11b1f380750"></a><!-- doxytag: member="USBRCVR::dBytesRemaining" ref="e11c88a0de1828a7b0e7a11b1f380750" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="common_8h.html#91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> <a class="el" href="class_u_s_b_r_c_v_r.html#e11c88a0de1828a7b0e7a11b1f380750">USBRCVR::dBytesRemaining</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00182">182</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>Referenced by <a class="el" href="sam7xpud_8hpp-source.html#l00192">OnReceiveUSB()</a>, and <a class="el" href="usb_tasks_8cpp-source.html#l00248">Receiver()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a4d0a9f5f141767eceec755624addf04"></a><!-- doxytag: member="USBRCVR::semaReceived" ref="a4d0a9f5f141767eceec755624addf04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classx_s_e_m_a.html">xSEMA</a> <a class="el" href="class_u_s_b_r_c_v_r.html#a4d0a9f5f141767eceec755624addf04">USBRCVR::semaReceived</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="sam7xpud_8hpp-source.html#l00186">186</a> of file <a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a>.</p>

<p>Referenced by <a class="el" href="sam7xpud_8hpp-source.html#l00192">OnReceiveUSB()</a>, and <a class="el" href="usb_tasks_8cpp-source.html#l00248">Receiver()</a>.</p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>src/inc/<a class="el" href="sam7xpud_8hpp-source.html">sam7xpud.hpp</a><li>src/<a class="el" href="usb_tasks_8cpp-source.html">usbTasks.cpp</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Mar 10 02:42:34 2008 for XPU-DSAM7S by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
